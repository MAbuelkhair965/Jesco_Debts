<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>JESKO ERP</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body style="background:#1a1a1a; color:white; text-align:center; font-family:sans-serif;">

    <h2>نظام مديونيات جيسكو</h2>
    
    <div style="margin-bottom:20px;">
        <input type="text" id="N" placeholder="الاسم" style="padding:10px;">
        <input type="number" id="A" placeholder="المبلغ" style="padding:10px;">
        <button onclick="saveData()" style="padding:10px 20px; background:blue; color:white; border:none;">حفظ في السحاب</button>
    </div>

    <table border="1" style="width:100%; border-collapse:collapse;" id="myTable">
        <thead>
            <tr><th>الاسم</th><th>المبلغ</th><th>حذف</th></tr>
        </thead>
        <tbody id="result"></tbody>
    </table>

    <script>
        // بياناتك الأصلية
        const firebaseConfig = {
            apiKey: "AIzaSyADCXCtLlwART44oEK7B36PmCfzE8mTxi0",
            authDomain: "jesko-erp.firebaseapp.com",
            projectId: "jesko-erp",
            storageBucket: "jesko-erp.firebasestorage.app",
            messagingSenderId: "820083064794",
            appId: "1:820083064794:web:2a7f80e53b6ecb94660ae3"
        };

        // تشغيل الخدمة
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // دالة الحفظ مع "تنبيه" بالخطأ
        function saveData() {
            const name = document.getElementById('N').value;
            const amount = document.getElementById('A').value;

            if(name && amount) {
                db.collection("debts").add({
                    customer: name,
                    money: parseFloat(amount),
                    time: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => { alert("تم الحفظ بنجاح!"); })
                .catch((error) => { alert("حصل خطأ: " + error.message); });
            }
        }

        // عرض البيانات
        db.collection("debts").orderBy("time", "desc").onSnapshot((querySnapshot) => {
            const list = document.getElementById('result');
            list.innerHTML = "";
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                list.innerHTML += `<tr>
                    <td>${data.customer}</td>
                    <td>${data.money}</td>
                    <td><button onclick="deleteData('${doc.id}')">X</button></td>
                </tr>`;
            });
        });

        function deleteData(id) {
            db.collection("debts").doc(id).delete();
        }
    </script>
</body>
</html>
